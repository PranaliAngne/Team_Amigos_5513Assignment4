---
title: "Amigos_Assignment4"
author: "Pranali Angne"
author: "Nishtha Arora"
author: "Raunak Bhivpathaki"
date: "5/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\section*{Q1, Part A}

``` {r Loading-libraries, echo= FALSE, warning= FALSE, message = FALSE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(ggmap)
library(maps)
library(kableExtra)
library(readr)
library(plotly)
```


```{r reading-data, echo= FALSE, warning= FALSE, message = FALSE}
data <-read_csv("data/building-approvals.csv")
geometry <- read_csv("data/suburbs.csv")
join <- left_join(data, geometry)
```


```{r data-cleaning, echo=FALSE, warning= FALSE, message = FALSE}
question0 <- join %>% dplyr :: select (`Application Type`, 
                                      `Date Of Decision Notice`,
                                      Decision,
                                      Class,
                                      Subcategory,
                                      Category,
                                    `Estimated Cost` ,
                                      Suburb,
                                    Latitude,
                                    Longitude
                                      )
```

**Variable Names**

After data cleaning according to our research questions, we will be selecting the following variables:

```{r tab1, echo= FALSE, warning= FALSE, message = FALSE, out.width= "3%"}
summary <- colnames(question0)
knitr::kable(summary, col.names = gsub("[.]", " ", names(summary)), align = "l", caption = "Variable Names") %>% 
kable_paper("hover")
```

For table \@ref(tab:tab1), the **description of the variables** used in the data set:

+ **Application type**: Here, application for 'building certification lodgements'.

+ **Date of decision notice**: The date the building certifier made a notice that the works met the building codes.

+ **Decision**: Current status of the works as recorded with Council.

+ **Class**: The building classification as per the list on page one.

+ **Sub-category (Council category descriptors)**: This category is a subdivision of class. Provides information regarding additions, alterations, subdwell etc in it.

+ **Category**: Townsville City Council has published on its website for a number of years a summary of building approval data using the certain categories.

+ **Estimated values**: The monetary value of the proposed building work.

+ **Suburb**: The suburb where the building work is taking place.

+ **Latitude and Longitude**: Geometrical dimensions. 

## Answering **Research Question 1.**

### Finding **Year** with **maximum approvals** as a decision, overall.

```{r graph1, echo= FALSE, warning= FALSE, message = FALSE, fig.height= 5, fig.width=9, fig.cap= "Year v/s Decision count", fig.pos='H', fig.align='center'}
question1 <- question0 %>% 
  mutate(`Date Of Decision Notice` = dmy(`Date Of Decision Notice`),
        Year = year(`Date Of Decision Notice`))

question1.1 <- question1 %>% 
  select(Year, Decision) %>% 
  count(Decision, Year) %>% 
  rename(`Total number of Decision` = n)

# plotting this graph
graph1 <- ggplot(data = question1.1, aes(x = Year,
                             y = `Total number of Decision`, 
                             fill = Decision)) +
  geom_bar(stat="identity", position = "dodge") +
  scale_fill_brewer(palette="Dark2")+
  theme(plot.title = element_text(hjust = 0.5))+
  theme_get() +
  xlab("Year") +
  ylab("Total count of Decision") 

ggplotly(graph1)
```

From the graph \@ref(fig:graph1), we see that, **finalized projects have maximum count**, but we will **consider the count of approved projects** into consideration because: 

Finalized projects are projects sent by architects to be approved by the regulation committee and the approved projects are the **confirmed** projects. Thus, it makes more sense to consider approved projects over finalized while deciding the **best year**.

+ The year **2020** has maximum **approvals** till now.

### Finding **class** occuring in maximum suburbs and finding its total count, for approved projects in 2020.

*(Keeping, 'Year as 2020' and 'Decision as Approved', constant)*

```{r class, message=FALSE,echo=FALSE,warning=FALSE}
question2 <- question1 %>% 
  filter(Decision %in% c("#Approved"),
         Year=="2020")
```

```{r plot2, fig.cap= "Distribution of class in Townsville's subrub area's", message=FALSE,warning=FALSE,echo=FALSE, fig.height= 5, fig.width=8, fig.align='center'}
map <- qmplot(Longitude, Latitude, data = question2 , size = I(1.5), darken = .3, fill= Class) 
ggplotly(map)
```

In figure (map) \@ref(fig:plot2), using *plotly*, we observe that **Class 1a** occurs in maximum suburbs.

```{r tab2, echo= FALSE, warning= FALSE, message = FALSE}
question2.1 <- question2 %>% 
  select(Year, Class) %>% 
  group_by(Year, Class) %>% 
  count(Class) %>% 
  rename(Count_of_Class = n) %>% 
  arrange(desc(Count_of_Class))
knitr::kable(head(question2.1), caption = "Count of class for approved projects") %>% 
   kable_paper("hover", full_width = T) %>% 
  row_spec(1, bold = T, color = "white", background = "#D7261E")
```

Table \@ref(tab:tab2) gives us the total count of Class 1a. It shows that **Class 1a** has the **maximum count** out of all the other classes.

**Class 1a includes :Single dwelling, detached house, town house or villa unit.**

From figure \@ref(fig:plot2) and table \@ref(tab:tab2), we were able to find out that the class 1a occurs in most suburbs. Each suburbs can have *multiple class 1a projects*.

+ Not only does it occur in most of the suburbs, but also these projects have a maximum count among all other projects.

+ Therefore, **Class 1a** occurs for most areas and maximum no. of times for *approved projects* in the year *2020*.





\section*{2}


\section*{3}


\section*{Q2, Part B}

``` {r load-lib, echo= FALSE, warning= FALSE, message = FALSE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(kableExtra)
library(readr)
library(RColorBrewer)
library(randomcoloR)
library(plotly)
library(gapminder)
```

```{r read-data, message=FALSE, warning=FALSE,echo=FALSE}
sec4 <-read_csv("data/building-approvals.csv") %>% 
  mutate(`Date Of Decision Notice` = dmy(`Date Of Decision Notice`),
        Year = year(`Date Of Decision Notice`)) 
```

### Out of *Class 10a* and *Class 1a*, finding **category** that is most in demand for *approved projects* in *Kirwan(2020)* and *Hermit Park(2021)* respectively.

*(Keeping, 'Decision as Approved','Suburbs as Kirwan and Hermit Park',constant.*
 *Keeping 'Year as 2021' and 'Class as 10a' constant for Kirwan.*
 *Keeping 'Year as 2020' and 'Class as 1a' constant for Hermit Park.)*

```{r filter-kirwan, message=FALSE, warning=FALSE,echo=FALSE}
catK <- sec4 %>% 
    filter(Year == "2021", Decision == "#Approved", Suburb == "Kirwan", Class == "Class 10a") 
K <- catK %>% 
  group_by(Year,Class,Decision,Suburb,Category) %>% 
  count(Category) %>% 
rename(Category_count = n)

```

```{r filter-hp, message=FALSE, warning=FALSE,echo=FALSE}
catHP <- sec4 %>% 
    filter(Year == "2020", Class == "Class 1a", Decision == "#Approved", Suburb == "Hermit Park")
HP <- catHP %>% 
    group_by(Year,Class,Decision,Suburb,Category) %>% 
  count(Category) %>% 
rename(Category_count = n)
```

```{r colour, message=FALSE, warning=FALSE,echo=FALSE}
c6 <- c(
  "dodgerblue2", "darkturquoise", "green1",  "green4", "#6A3D9A",  "#FF7F00", "black")
```

```{r fig6,  fig.cap= "Count of Categories for their respective Suburbs and Class", fig.show="hold", out.width="50%", message=FALSE, warning=FALSE,echo=FALSE, fig.align='center'}
ggplot(K,
       aes(y = Category_count, x = Class, fill = Category)) +
  geom_col() +
 coord_polar() +
  scale_fill_manual(values = c6) +
  ggtitle("For 'Kirwan' in Class 10a (2021).") +
theme(axis.text = element_blank())

ggplot(HP,
       aes(y = Category_count, x = Class, fill = Category)) +
  geom_col() +
 coord_polar() +
  scale_fill_manual(values = c6) +
  ggtitle("For 'Hermit Park' in Class 1a (2020).")+
theme(axis.text = element_blank())
```

The figure \@ref(fig:fig6) displays two polar graphs with category count in Kirwan(left) and category count in Hermit Park(right).

+ It is evident from both the graphs that the **Residential-Other** category for *approved projects*, is in demand for *both suburbs* and *both classes* in their respective *years*.