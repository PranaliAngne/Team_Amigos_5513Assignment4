---
title: "Analyzing Building approvals data for the City of Townsville"
author: "Pranali Angne, Nishtha Arora, Raunak Bhivpathaki"
date: "`r lubridate::today()`"
abstract: |
 The Building Approvals data set produced by Townsville City Council contains information about most of the building work that has been approved in the Townsville local government area. This information is used by industry and government as a key economic indicator.
 <br><br><br>
output:
    bookdown::html_document2:
        base_format: prettydoc::html_pretty
        keep_md: yes
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

The analysis in the report is regarding **building certification lodgements** in the Townsville local government area. **Townsville is a city and a major port area in eastern Queensland, Australia.** Two data sets have been combined and used for the analysis from the  [www.data.gov.au](https://data.gov.au) website. 

First data set i.e. the building approval details have been extracted from [here](https://data.gov.au/data/dataset/tcc-building-approvals) ("Townsville City Council Building Approvals - data.gov.au", 2021) and includes number of building approvals from 2009 to 2021 and their corresponding details e.g. Decision, Class, Suburb etc. And the second data set i.e. City of Townsville's Suburb geometry has been extracted from [here](https://data.gov.au/dataset/ds-dga-81cbbedc-e35f-4266-980d-21a6159b2404/distribution/dist-dga-28812258-4cf4-46aa-aa43-0206d7c60920/details?q=) ("Townsville Suburbs - data.gov.au.", 2021) and includes the geometrical values for these Suburbs.

This report has been complied using R Studio ("RStudio Team", 2020), [Github](https://github.com/PranaliAngne/Team_Amigos_5513Assignment4) ("GitHub: Where the world builds software", 2021), Gitkraken("GitKraken Documentation", 2021) and Atom("A hackable text editor for the 21st Century", 2021).

**Project Details**

- Name: **Analyzing Building approvals data for the City of Townsville** (Assignment 4, ETC5513)

- Objective: Answering research questions regarding Year, Approvals, Class, Category, Suburb and Estimated Cost for Building Approvals in the city of Townsville.

**Research Questions**

1. To identify the year with maximum approvals and to analyze the data further to find out the suburb and estimate cost of building with respect to the most popular class in that year. And also find out the category that is most in demand for that class.

2. To analyze the suburb which was inferred from research question 1 and find out the year for which it had the maximum approvals. Also find out the class that occurred maximum times, category with respect to that class and estimate cost for these particular variables.

```{r image, echo = F, out.width= "40%", fig.align='center'}
knitr::include_graphics("images/CTV.jpg")
```


# Analysis

(Please use **plotly** (*Click on the figure/table to active plotly*) to hover through the figures/tables and maps for better understanding of the analysis)

\section*{Q1, Part A}

``` {r Loading-libraries, echo= FALSE, warning= FALSE, message = FALSE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(ggmap)
library(maps)
library(kableExtra)
library(readr)
library(plotly)
```


```{r reading-data, echo= FALSE, warning= FALSE, message = FALSE}
data <-read_csv("data/building-approvals.csv")
geometry <- read_csv("data/suburbs.csv")
join <- left_join(data, geometry)
```

```{r data-cleaning, echo=FALSE, warning= FALSE, message = FALSE}
question0 <- join %>% dplyr :: select (`Application Type`, 
                                      `Date Of Decision Notice`,
                                      Decision,
                                      Class,
                                      Subcategory,
                                      Category,
                                    `Estimated Cost` ,
                                      Suburb,
                                    Latitude,
                                    Longitude
                                      )
```

**Variable Names**

After data cleaning according to our research questions, we will be selecting the following variables:

```{r tab1, echo= FALSE, warning= FALSE, message = FALSE, out.width= "3%"}
summary <- colnames(question0)
knitr::kable(summary, col.names = gsub("[.]", " ", names(summary)), align = "l", caption = "Variable Names") %>% 
kable_paper("hover")
```

For table \@ref(tab:tab1), the **description of the variables** used in the data set:

+ **Application type**: Here, application for 'building certification lodgements'.

+ **Date of decision notice**: The date the building certifier made a notice that the works met the building codes.

+ **Decision**: Current status of the works as recorded with Council.

+ **Class**: The building classification as per the list on page one.

+ **Sub-category (Council category descriptors)**: This category is a subdivision of class. Provides information regarding additions, alterations, subdwell etc in it.

+ **Category**: Townsville City Council has published on its website for a number of years a summary of building approval data using the certain categories.

+ **Estimated values**: The monetary value of the proposed building work.

+ **Suburb**: The suburb where the building work is taking place.

+ **Latitude and Longitude**: Geometrical dimensions. 

## Answering **Research Question 1.**

### Finding **Year** with **maximum approvals** as a decision, overall.

```{r graph1, echo= FALSE, warning= FALSE, message = FALSE, fig.height= 5, fig.width=9, fig.cap= "Year v/s Decision count", fig.pos='H', fig.align='center'}
question1 <- question0 %>% 
  mutate(`Date Of Decision Notice` = dmy(`Date Of Decision Notice`),
        Year = year(`Date Of Decision Notice`))

question1.1 <- question1 %>% 
  select(Year, Decision) %>% 
  count(Decision, Year) %>% 
  rename(`Total number of Decision` = n)

# plotting this graph
graph1 <- ggplot(data = question1.1, aes(x = Year,
                             y = `Total number of Decision`, 
                             fill = Decision)) +
  geom_bar(stat="identity", position = "dodge") +
  scale_fill_brewer(palette="Dark2")+
  theme(plot.title = element_text(hjust = 0.5))+
  theme_get() +
  xlab("Year") +
  ylab("Total count of Decision") 

ggplotly(graph1)
```

From the graph \@ref(fig:graph1), we see that, **finalized projects have maximum count**, but we will **consider the count of approved projects** into consideration because: 

Finalized projects are projects sent by architects to be approved by the regulation committee and the approved projects are the **confirmed** projects. Thus, it makes more sense to consider approved projects over finalized while deciding the **best year**.

+ The year **2020** has maximum **approvals** till now.







\section*{2}

```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(tidyverse)
library(readr)
library(lubridate)
library(kableExtra)
```

```{r, message=FALSE, warning=FALSE, echo=FALSE}
Sec2 <- read_csv("data/building-approvals.csv")
```

Q2. Which category is most in demand/occurs maximum times in the year 2020?

```{r Filtering, message=FALSE, warning=FALSE,echo=FALSE}
Filtered <- Sec2 %>%  mutate(`Date Of Decision Notice` = dmy(`Date Of Decision Notice`),
        Year = year(`Date Of Decision Notice`)) %>% 
  filter(Year == "2020")
```

```{r}
Tab <- Filtered %>% count(Category)  %>% 
  rename(Count = n) %>% 
  arrange(desc(Count))
knitr::kable(head(Tab), caption = "Count of categories in 2020") %>% 
   kable_paper("hover", full_width = T)
```

Q3. Which is the suburb, where it costs the maximum for the category  "Residential-Other", in the year 2020?

```{r, fig.height= 5, fig.width=5}
Fig <- Filtered %>% 
  filter(Category == "Residential - Other") %>% 
  rename(Estimated_Cost = `Estimated Cost`) %>% 
mutate(Estimated.Cost = as.factor(Estimated_Cost)) 
  Fig$Estimated.Cost = as.numeric(gsub("[\\$,]", "", Fig$Estimated.Cost)) 
  
  ggplot(Fig,
         aes(x= Estimated.Cost,
             y= Suburb, fill= Category))+
    geom_col() +
    scale_x_continuous(labels = scales::comma)
    
```







\section*{3}

## Answering **Research Question 2.**

``` {r library, echo= FALSE, warning= FALSE, message = FALSE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(kableExtra)
library(readr)
library(plotly)
```

```{r read, message=FALSE, warning=FALSE, echo=FALSE}
Section3 <- read_csv("data/building-approvals.csv") %>%  mutate(`Date Of Decision Notice` = dmy(`Date Of Decision Notice`),
        Year = year(`Date Of Decision Notice`))
```

```{r}
suburb <- Filtered %>% 
  filter(Year == "2020") %>% 
  filter( Category == "Residential - Other") %>% 
  select(Suburb, Decision, Category, Year ) %>% 
  group_by(Suburb) %>% 
count(Decision) %>% 
  rename(Total_Approvals = n) %>% 
  arrange(desc(Total_Approvals))
```

