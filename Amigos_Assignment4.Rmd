---
title: "Amigos_Assignment4"
author: "Pranali Angne"
author: "Nishtha Arora"
author: "Raunak Bhivpathaki"
date: "5/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

The data used in the report is regarding building certification lodgements in the Townsville local government area. Townsville is a city and a major port area in eastern Queensland, Australia. The data set been extracted from [www.data.gov.au](https://data.gov.au/data/dataset/tcc-building-approvals). 

This data set includes number of building approvals from 2009 to 2021 and can be aggregated by month, suburb and local government electoral division.  

The objective of the report is to identify the year with maximum approvals and to analyze data regarding the building category maximum in demand i.e. the Suburb and total cost for that category.

\section*{1}


\section*{Q1, Part B}

``` {r libraries, echo= FALSE, warning= FALSE, message = FALSE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(kableExtra)
library(readr)
library(RColorBrewer)
library(randomcoloR)
library(plotly)
library(gapminder)
```

```{r reading_data, message=FALSE, warning=FALSE,echo=FALSE}
sec2 <-read_csv("data/building-approvals.csv") %>% 
  mutate(`Date Of Decision Notice` = dmy(`Date Of Decision Notice`),
        Year = year(`Date Of Decision Notice`)) 
```

### Finding **category** with maximum counts in Class 1a (approved projects), in 2020.

*(Keeping, 'Decision as Approved' and 'Class as 1a', constant and showing variation for years and identifying category count for 'Year 2020')*

```{r filtering, message=FALSE, warning=FALSE,echo=FALSE}
Filtered <- sec2 %>%  
  filter(Class == "Class 1a", Decision == "#Approved")
grouping <- Filtered %>% 
    group_by(Category, Year) %>% 
  count(Category) %>% 
  rename(Count =n)
```

```{r fig3, message=FALSE,warning=FALSE,echo=FALSE, fig.cap="Count v/s Category", fig.height= 5, fig.width=10, fig.align='center'}
df <- grouping
fig <- df %>%
  plot_ly(
    x = ~Category, 
    y = ~Count, 
    color = ~Category, 
    frame = ~Year, 
    type = 'scatter',
    mode = 'markers'
  )
fig
```

In figure \@ref(fig:fig3), by clicking on *play*, we observe that for half the years in the data set, *Residential-Other* category has been on the top and for the other half, *Single Detached Dwelling-New* has been in demand.

+ Identifying for the year 2020, we see that out of *Class 1a*, **Residential-Other** category is most in demand out of *approved projects* in the year *2020*.

### Finding **Suburb** for Residential category (Class 1a), approved projects in 2020.

*(Keeping, 'Year as 2020'. 'Decision as Approved', 'Class as 1a' and 'Category as Residential-Other', constant)*

```{r colours, echo= FALSE, warning= FALSE, message = FALSE}
 c50 <- c(
  "dodgerblue2", "#E31A1C",  "green4", "#6A3D9A",  "#FF7F00", "black", "gold1", "skyblue2", "#FB9A99", "palegreen2", "#CAB2D6", "#FDBF6F","gray70", "khaki2", "maroon", "orchid1", "deeppink1", "blue1", "steelblue4",
  "darkturquoise", "green1", "yellow4", "yellow3", "darkorange4", "brown", "pink1", "violet", "mediumpurple1", "slateblue1", "purple", "purple3",
"turquoise2", "skyblue", "steelblue", "blue2", "navyblue", "orange", "tomato", "coral2", "palevioletred", "violetred", "red2","springgreen2", "yellowgreen", "palegreen4", "wheat2", "tan", "tan2", "tan3", "brown",
 "grey70", "grey50", "grey30"
)
```

```{r fig4, message=FALSE, warning=FALSE, echo=FALSE, fig.width=10, fig.height=5, fig.cap= "Suburb v/s Approval Count", fig.align='center'}
polar <- Filtered %>% 
  filter(Year == "2020") %>% 
  filter( Category == "Residential - Other") %>% 
  select(Suburb, Decision, Category, Year ) %>% 
  group_by(Suburb) %>% 
count(Decision) %>% 
  rename(Total_Approvals = n) %>% 
  arrange(desc(Total_Approvals))

ggplot(polar,
       aes(y = Total_Approvals, x = Suburb, fill = Suburb)) +
  geom_col() +
 coord_polar() +
scale_fill_manual(values = c50) +
theme(axis.text = element_blank())
```

Figure \@ref(fig:fig4) shows that suburbs *Kirwan* and *Hermit Park* have the maximum approval count.

+ Therefore, the suburbs **Kirwan** and **Hermit Park**, have most no. of *class 1a*'s with category as *Residential-Other* in *approved projects* for *2020*.

### Estimated **cost(x)** for research question 1.

By *(Keeping, 'Year as 2020'. 'Decision as Approved', 'Class as 1a' and 'Category as Residential-Other', constant)*

```{r estimated-cost, echo= FALSE, warning= FALSE, message = FALSE}
cost <- sec2 %>% 
    filter(Year == "2020", Class == "Class 1a", Decision == "#Approved", Category == "Residential - Other") %>% 
  rename(Estimated_Cost = `Estimated Cost`) %>% 
mutate(Estimated.Cost = as.factor(Estimated_Cost)) 
  cost$Estimated.Cost = as.numeric(gsub("[\\$,]", "", cost$Estimated.Cost)) 
```


```{r tab3, echo= FALSE, warning= FALSE, message = FALSE}
kirwan <- cost %>% 
  filter(Suburb == "Kirwan") 
k <- sum(kirwan$Estimated.Cost)
knitr::kable(head(k), caption = "Estimated cost for Kirwan") %>% 
   kable_paper("hover") %>% 
  row_spec(1, bold = T, color = "black", background = "white")
```

Table \@ref(tab:tab3) displays the cost for Kirwan in best year 2020.

```{r tab4, echo= FALSE, warning= FALSE, message = FALSE}
hermit_park <- cost %>% 
  filter(Suburb == "Hermit Park") 
hp <- sum(hermit_park$Estimated.Cost)
knitr::kable(head(hp), caption = "Estimated cost for Hermit Park") %>% 
   kable_paper("hover") %>% 
  row_spec(1, bold = T, color = "black", background = "#87CEEB")
```

Table \@ref(tab:tab4) displays the cost for Hermit Park in best year 2020.

```{r tab5, echo= FALSE, warning= FALSE, message = FALSE}
s <- sum(k,hp)
knitr::kable(head(s), caption = "Total estimated cost for research question 1") %>% 
   kable_paper("hover") %>% 
  row_spec(1, bold = T, color = "black", background = "yellow")
```

+ Therefore by observing table \@ref(tab:tab5), we know that the **total cost** for suburbs *Kirwan* and *Hermit Park*'s *class 1a* *approved* projects(*Residential-Other* category) in *2020* is **$2,068,312**









\section*{3}

\section*{Conclusion}
```{r conc-lib, echo= FALSE, warning= FALSE, message = FALSE}
library(DiagrammeR)
```

# Conclusion :

## Result 1: 

### The result for the **first research question** is depicted below:

```{r fig7, fig.width=9, fig.height=5, echo= FALSE, warning= FALSE, message = FALSE, fig.cap="Result 1 Flowchart", fig.align='center'}
grViz("digraph flowchart {
      # node definitions with substituted label text
      node [fontname = Helvetica, shape = rectangle]        
      tab1 [label = '@@1']
      tab2 [label = '@@2']
      tab3 [label = '@@3']
      tab4 [label = '@@4']
      tab5 [label = '@@5']
      tab6 [label = '@@6']
      tab7 [label = '@@7']
      tab8 [label = '@@8']
      tab9 [label = '@@9']

      # edge definitions with the node IDs
      tab1 -> tab2 ;
      tab2 -> tab3;
      tab3 -> tab4;
      tab4 -> tab5;
      tab4 -> tab6;
      tab5 -> tab7;
      tab6 -> tab8;
      tab7 -> tab9;
      tab8 -> tab9;
      }

      [1]: 'Maximum APPROVALS'
      [2]: 'Year of 2020'
      [3]: 'Maximum Projects : Class 1A'
      [4]: 'Belonging to: RESIDENTIAL - OTHER category'
      [5]: 'Maximum Projects at : KIRWAN Suburb'
      [6]: 'Maximum Projects at : HERMIT PARK Suburb'
      [7]: 'Estimated Cost: $993,644'
      [8]: 'Estimated Cost: $1,074,668'
      [9]: 'Total Cost: $2,068,312'
      ")
```

Figure (flowchart) \@ref(fig:fig7) depicts the step-wise-step results for research question 1.

+ We observed that the end product of result 1 gives us two suburbs with maximum residential category in class 1a for approved projects in the year 2020.

+ Further we carried out a **reverse analysis** for the resulting suburbs in question 1 i.e. for *Kirwan* and *Hermit Park*.
